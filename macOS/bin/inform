#!/bin/bash

# In case of any problem with displaying notifications, make sure that:
# * 'Terminal' has permissions to do so.
# * Do not disturb mode, or any other silencer are off.
#
# If still notifications are not displayed, try to run the osascritp commands directly form treminal to see any errors.
#
# But, if no errors and notifications still desn't work, then:
# * Open "Script Editor" app.
# * Paste `display notification "Hello from editor" with title "Hello!"`.
# * Run it (not debug, just run).
# MacOS should ask you for permissions for "Script Editor" to display notifications. Then it should work from terminal as well.
# https://forum.latenightsw.com/t/trying-to-use-terminal-for-display-notification/5068?u=dirk
#
# Sometimes notifiaction can be broken. To fix, first restart computer.
# If it doesn't help, try to reset notification settings:
# delete "~/Library/Group Containers/group.com.apple.usernotifications/"

status_code_input="${1}"

message_title="Infrom Script"
if [ -n "${TAB_NAME}" ]; then
    message_title="${message_title} - ${TAB_NAME}"
fi

function message_success {
    osascript -e "display notification \"Success üíÉ\" with title \"${message_title}\" subtitle \"Script reported success ‚úÖ\" sound name \"Submarine\""
    say "Hooray\! Success\!"
}

function message_fail {
    osascript -e "display notification \"Error code: ${status_code_input} üò≠\" with title \"${message_title}\" subtitle \"Script reported fail ‚ùå\" sound name \"Sosumi\""
    say "Oh my God\! What've just happened here?"
}

function async_message_success {
    message_success &
}

function async_message_fail {
    message_fail &
}


[ "${status_code_input}" -eq "0" ] && async_message_success || async_message_fail

# Forward error code for transparency
exit "${status_code_input}"

